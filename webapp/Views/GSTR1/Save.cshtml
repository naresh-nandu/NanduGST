<form name="GSTR1SaveForm" id="GSTR1SaveForm" method="post" autocomplete="off">
    <!-- MAIN CONTENT -->
    <div id="content">

        <!-- row -->
        <div class="row">

            <!-- col -->
            <div class="col-xs-12 col-sm-7 col-md-7 col-lg-4">
                <h1 class="page-title txt-color-blueDark">

                    <!-- PAGE HEADER -->
                    <i class="fa-fw fa fa-home"></i>
                    GSTR 1
                    <span>
                        >&nbsp;
                        SAVE
                    </span>
                </h1>
            </div>
            <!-- end col -->
            <!-- right side of the page with the sparkline graphs -->
            <!-- col -->
            <!-- end col -->

        </div>
        <!-- end row -->
        <!--
                The ID "widget-grid" will start to initialize all widgets below
                You do not need to use widgets if you dont want to. Simply remove
                the <section></section> and you can use wells or panels instead
                -->
        <!-- widget grid -->
        <section id="widget-grid" class="">

            <!-- row -->
            <div class="row">

                <!-- NEW WIDGET START -->
                <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">

                    <!-- Widget ID (each widget will need unique ID)-->
                    <div class="jarviswidget jarviswidget-color-greenDark" id="wid-id-0" data-widget-editbutton="false" data-widget-custombutton="false" data-widget-deletebutton="false">

                        <header>
                            <span class="widget-icon"><i class="fa fa-edit"></i></span>
                            <h2>GSTR-1 Save</h2>
                        </header>

                        <!-- widget div-->
                        <div>

                            <!-- widget edit box -->
                            <div class="jarviswidget-editbox">
                                <!-- This area used as dropdown edit box -->

                            </div>
                            <!-- end widget edit box -->
                            <!-- widget content -->
                            <div class="widget-body no-padding">

                                <div id="comment-form" class="smart-form">

                                    <fieldset>

                                        <div class="row">
                                            <section class="col col-3">
                                                <label class="label">Record Type</label>
                                                <div class="col-xs-12 col-lg-12 selectContainer">
                                                    @Html.DropDownList("ddlRecordType", ViewBag.RecordTypeList as SelectList, "Select", new { @class = "form-control", id = "ddlRecordType" })
                                                </div>
                                            </section>

                                            <section class="col col-3">
                                                <label class="label">Period</label>
                                                <div class="col-xs-12 col-lg-12 selectContainer">
                                                    <label class="input">
                                                        <i class="icon-append fa fa-calendar"></i>
                                                        <input type="text" name="period" placeholder="" id="period" class="datepicker" data-dateformat='mmyy' value="@ViewBag.Period">
                                                    </label>
                                                </div>
                                            </section>

                                            <section class="col col-3">
                                                <label class="label">GSTIN</label>
                                                <div class="col-xs-12 col-lg-12 selectContainer">
                                                    @Html.DropDownList("ddlGSTINNo", ViewBag.GSTINNoList as SelectList, "Select ALL", new { @class = "form-control", id = "ddlGSTINNo" })
                                                </div>
                                            </section>

                                            <section class="col col-3">
                                                <label class="label">GSTR Type</label>
                                                <div class="col-xs-12 col-lg-12 selectContainer">
                                                    @Html.DropDownList("ddlGSTR", ViewBag.GSTRList as SelectList, "Select GSTR", new { @class = "form-control", id = "ddlGSTR" })
                                                </div>
                                            </section>

                                            @*@if (ViewBag.GSTRType != null)
                                                {*@
                                            <section class="col col-3" id="DispActionType">
                                                <label class="label">Action</label>
                                                <div class="col-xs-12 col-lg-12 selectContainer">
                                                    @Html.DropDownList("ddlActionType", ViewBag.ActionList as SelectList, "Select Action", new { @class = "form-control", id = "ddlActionType" })
                                                </div>
                                            </section>
                                            @*}*@
                                            <section class="col col-3">
                                                <label class="input"></label>
                                                <div class="form-group">
                                                    <input type="hidden" name="InvIds" id="InvIds" />
                                                </div>
                                            </section>
                                        </div>

                                        <section class="col col-3">
                                            <label class="input"></label>
                                            <div class="form-group">
                                                <input type="hidden" name="strExportAction" id="strExportAction" />
                                            </div>
                                        </section>

                                    </fieldset>

                                    <footer>
                                        <button type="button" name="ViewSummary" id="ViewSummary" value="View Summary" class="btn btn-primary pull-left" style="border-radius:13px; font-weight:600">
                                            View Summary
                                        </button>
                                        <button type="button" name="GSTR1Save" id="GSTR1Save" value="GSTR 1 Save" class="btn btn-primary pull-left" style="border-radius:13px;font-weight:600">
                                            GSTR 1 Save
                                        </button>
                                        <button type="button" name="GetJson" id="GetJson" value="GetJson" class="btn btn-primary pull-right" style="border-radius:13px;font-weight:600">
                                            GET JSON PAYLOAD
                                        </button>
                                        @if (Session["GenerateGSTR1HSN"].ToString() == "True")
                                        {
                                            <button type="button" name="btnHSNSummary" id="btnHSNSummary" value="HSN Summary" class="btn btn-primary pull-right" style="border-radius:13px; font-weight:600"
                                                    onclick="return confirm('Are you sure want to Generate HSN Summary?');">
                                                Generate HSN Summary
                                            </button>
                                        }
                                    </footer>

                                </div>

                            </div>
                            <!-- end widget content -->

                        </div>
                        <!-- end widget div -->

                    </div>
                    <!-- end widget -->
                    <!-- Widget ID (each widget will need unique ID)-->
                    <div class="jarviswidget jarviswidget-color-greenLight" id="wid-id-1" data-widget-editbutton="false" data-widget-custombutton="false" data-widget-deletebutton="false">

                        <header>
                            <span class="widget-icon"> <i class="fa fa-edit"></i> </span>
                            <h2>GSTR-1 Save</h2>
                        </header>

                        <div class="table table-responsive">

                            <div class="container-fuild" style="background-color:white;">
                                <table id="TBL_GSTR1SAVE_SUMMARY" class="table table-striped table-bordered dt-responsive nowrap" width="100%" cellspacing="0">
                                    <thead>
                                        <tr>
                                            <th>Action Type</th>
                                            <th>Record Count</th>
                                            <th>No Of Invoices</th>
                                            <th>Taxable Value</th>
                                            <th>IGST Amount</th>
                                            <th>CGST Amount</th>
                                            <th>SGST Amount</th>
                                            <th>CESS Amount</th>
                                            <th>Export</th>
                                        </tr>
                                    </thead>
                                </table>

                            </div>

                        </div>


                    </div>
                    <!-- end widget -->

                </article>
            </div>

            <!-- end row -->

        </section>
        <!-- end widget grid -->

    </div>
    <!-- END MAIN CONTENT -->

    <div class="modal fade" id="myOTPModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="myModalLabel">GST Authentication</h4>
                </div>
                <div class="modal-body custom-scroll terms-body">
                    <div id="left">
                        <label>GSTIN No</label> : <div id="innerHTML_AUTH_GSTINNo" style="font-weight:bold;"></div>
                        <input type="hidden" name="AUTH_GSTINNo" id="AUTH_GSTINNo" value="@ViewBag.AUTH_GSTINNo" />
                        <br /><br />
                        <div id="innerHTML_AUTH_Response" style="font-weight:bold;"></div>
                        <br /><br />
                        <input type="text" id="OTP" name="OTP" class="form-group" placeholder="Enter OTP" />
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">
                            Cancel
                        </button>
                        <button type="button" name="OTPSubmit" id="OTPSubmit" value="OTP Submit" class="btn btn-primary" style="border-radius:13px; font-weight:600">
                            Submit
                        </button>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->
    </div>

    <div class="modal fade" id="myJsonPayloadModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="myModalLabel">GSTR-1 JSON PAYLOAD</h4>
                </div>
                <div class="modal-body custom-scroll terms-body">
                    <div id="innerHTML_GET_GSTR1JsonResponse" style="font-weight:bold;"></div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->
    </div>

</form>




<script type="text/javascript" language="javascript">

    function ShowMessage(param) {
        var data = $(param).parent().parent()["0"].childNodes[0].innerText;
        $('#strExportAction').val(data);
    }

    $(document).ready(function () {

        $("#DispActionType").hide();
        $("#btnHSNSummary").hide();
        $("#GSTR1Save").hide();
        $("#TBL_GSTR1SAVE_SUMMARY").hide();

        $("#OTPSubmit").click(function () {
            var url = '@Url.Action("Save", "GSTR1")';
            $("#divLoading").show();
            var frmdata = new FormData();
            frmdata.append("ddlRecordType", $("#ddlRecordType").val());
            frmdata.append("period", $("#period").val());
            frmdata.append("ddlGSTINNo", $("#ddlGSTINNo").val());
            frmdata.append("ddlGSTR", $("#ddlGSTR").val());
            frmdata.append("ddlActionType", $("#ddlActionType").val());
            frmdata.append("OTP", $("#OTP").val());
            frmdata.append("AUTH_GSTINNo", $("#AUTH_GSTINNo").val());
            frmdata.append("OTPSubmit", $("#OTPSubmit").val());
                $.ajax
                    ({
                        url: '/GSTR1/Save',
                        type: "POST",
                        contentType: false,
                        data: frmdata,
                        //async: true,
                        processData: false,
                        // cache: false,
                        success: function (resp) {
                            $("#divLoading").hide();
                            if (resp.success) {
                                //alert(resp.SaveResponse);
                                if (resp.SuccessMessage != null) {
                                    $('#myOTPModal').modal('toggle');
                                    swal({
                                        title: "",
                                        text: resp.SuccessMessage,
                                        type: "success",
                                        confirm: {
                                            text: "OK",
                                            value: true,
                                            visible: true,
                                            className: "",
                                            closeModal: true,
                                        },
                                        confirmButtonColor: "#DD6B55",
                                        confirmButtonText: "OK",
                                        closeOnConfirm: true,
                                    });
                                }
                                else {
                                    //alert(resp.ErrorMessage);
                                    $('#myOTPModal').modal('toggle');
                                    swal({
                                        title: "",
                                        text: resp.ErrorMessage,
                                        type: "error",
                                        confirm: {
                                            text: "OK",
                                            value: true,
                                            visible: true,
                                            className: "",
                                            closeModal: true,
                                        },
                                        confirmButtonColor: "#DD6B55",
                                        confirmButtonText: "OK",
                                        closeOnConfirm: true,
                                    });
                                }
                            }
                            else {
                                //alert(resp.ErrorMessage);
                                $('#myOTPModal').modal('toggle');
                                swal({
                                    title: "",
                                    text: resp.ErrorMessage,
                                    type: "error",
                                    confirm: {
                                        text: "OK",
                                        value: true,
                                        visible: true,
                                        className: "",
                                        closeModal: true,
                                    },
                                    confirmButtonColor: "#DD6B55",
                                    confirmButtonText: "OK",
                                    closeOnConfirm: true,
                                });
                            }
                        },
                        error: function (xhr) {
                            $("#divLoading").hide();
                            alert('error');
                        }
                    })
        });


        $("#btnHSNSummary").click(function () {
            var url = '@Url.Action("Save", "GSTR1")';
            $("#divLoading").show();
            var frmdata = new FormData();
            frmdata.append("ddlRecordType", $("#ddlRecordType").val());
            frmdata.append("period", $("#period").val());
            frmdata.append("ddlGSTINNo", $("#ddlGSTINNo").val());
            frmdata.append("ddlGSTR", $("#ddlGSTR").val());
            frmdata.append("ddlActionType", $("#ddlActionType").val());
            frmdata.append("OTP", $("#OTP").val());
            frmdata.append("AUTH_GSTINNo", $("#AUTH_GSTINNo").val());
            frmdata.append("btnHSNSummary", $("#btnHSNSummary").val());
                $.ajax
                    ({
                        url: '/GSTR1/Save',
                        type: "POST",
                        contentType: false,
                        data: frmdata,
                        //async: true,
                        processData: false,
                        // cache: false,
                        success: function (resp) {
                            $("#divLoading").hide();
                            if (resp.success) {
                                swal({
                                    title: "",
                                    text: resp.SuccessMessage,
                                    type: "success",
                                    confirm: {
                                        text: "OK",
                                        value: true,
                                        visible: true,
                                        className: "",
                                        closeModal: true,
                                    },
                                    confirmButtonColor: "#DD6B55",
                                    confirmButtonText: "OK",
                                    closeOnConfirm: true,
                                });
                            }
                            else {
                                swal({
                                    title: "",
                                    text: resp.ErrorMessage,
                                    type: "error",
                                    confirm: {
                                        text: "OK",
                                        value: true,
                                        visible: true,
                                        className: "",
                                        closeModal: true,
                                    },
                                    confirmButtonColor: "#DD6B55",
                                    confirmButtonText: "OK",
                                    closeOnConfirm: true,
                                });
                            }
                        },
                        error: function (xhr) {
                            $("#divLoading").hide();
                            alert('error');
                        }
                    })
        });

        $("#GetJson").click(function () {
            var url = '@Url.Action("Save", "GSTR1")';
            $("#divLoading").show();
            var frmdata = new FormData();
            frmdata.append("ddlRecordType", $("#ddlRecordType").val());
            frmdata.append("period", $("#period").val());
            frmdata.append("ddlGSTINNo", $("#ddlGSTINNo").val());
            frmdata.append("ddlGSTR", $("#ddlGSTR").val());
            frmdata.append("ddlActionType", $("#ddlActionType").val());
            frmdata.append("OTP", $("#OTP").val());
            frmdata.append("AUTH_GSTINNo", $("#AUTH_GSTINNo").val());
            frmdata.append("GetJson", $("#GetJson").val());
                $.ajax
                    ({
                        url: '/GSTR1/Save',
                        type: "POST",
                        contentType: false,
                        data: frmdata,
                        //async: true,
                        processData: false,
                        // cache: false,
                        success: function (resp) {
                            $("#divLoading").hide();
                            if (resp.success) {
                                if (resp.GetJsonSession == "OPEN_JSON_PAYLOAD") {
                                    $("#innerHTML_GET_GSTR1JsonResponse").html(resp.GET_GSTR1JsonResponse);
                                    $(document).ready(function () {
                                        $('#myJsonPayloadModal').modal();
                                    });
                                }
                            }
                            else {

                            }
                        },
                        error: function (xhr) {
                            $("#divLoading").hide();
                            alert('error');
                        }
                    })
            });

        $("#GSTR1Save").click(function () {
            var url = '@Url.Action("Save", "GSTR1")';
            $("#divLoading").show();

            var frmdata = new FormData();
            frmdata.append("ddlRecordType", $("#ddlRecordType").val());
            frmdata.append("period", $("#period").val());
            frmdata.append("ddlGSTINNo", $("#ddlGSTINNo").val());
            frmdata.append("ddlGSTR", $("#ddlGSTR").val());
            frmdata.append("ddlActionType", $("#ddlActionType").val());
            frmdata.append("OTP", $("#OTP").val());
            frmdata.append("AUTH_GSTINNo", $("#AUTH_GSTINNo").val());
            frmdata.append("GSTR1Save", $("#GSTR1Save").val());
            $.ajax
                ({
                    url: '/GSTR1/Save',
                    type: "POST",
                    contentType: false,
                    data: frmdata,
                    //async: true,
                    processData: false,
                    // cache: false,
                    success: function (resp) {
                        $("#divLoading").hide();
                        if (resp.success) {
                            swal({
                                title: "",
                                text: resp.SuccessMessage,
                                type: "success",
                                confirm: {
                                    text: "OK",
                                    value: true,
                                    visible: true,
                                    className: "",
                                    closeModal: true,
                                },
                                confirmButtonColor: "#DD6B55",
                                confirmButtonText: "OK",
                                closeOnConfirm: true,
                            });
                            $('#TBL_GSTR1SAVE_SUMMARY').DataTable({
                                destroy: true,
                                "aaData": resp.data.GSTR1Summary,
                                "aoColumns": [
                                    { "mData": "ActionType" },
                                    { "mData": "RecordCount" },
                                    { "mData": "NoOfInvoices" },
                                    { "mData": "txval" },
                                    { "mData": "iamt" },
                                    { "mData": "camt" },
                                    { "mData": "samt" },
                                    { "mData": "csamt" },
                                    {
                                        "mData": null, "bSortable": false, "mRender": function (data, type, full) {
                                            return '<button type="submit" name="command" id="exportrawData" value="exportrawData" class="btn btn-primary btn-lg btnstyle" onclick="javascript:return ShowMessage(this); " style="font-weight:bold; Border-radius:5px; width:80px; margin-bottom:3px; padding:3px;">Export</button>';
                                        }
                                    }
                                ]
                            });
                        }
                        else {
                            swal({
                                title: "",
                                text: resp.ErrorMessage,
                                type: "error",
                                confirm: {
                                    text: "OK",
                                    value: true,
                                    visible: true,
                                    className: "",
                                    closeModal: true,
                                },
                                confirmButtonColor: "#DD6B55",
                                confirmButtonText: "OK",
                                closeOnConfirm: true,
                            });
                        }
                        //alert(data);
                    },
                    error: function (xhr) {
                        $("#divLoading").hide();
                        alert('error');
                    }
                })

            });


        $("#ViewSummary").click(function () {
            $("#TBL_GSTR1SAVE_SUMMARY").show();
            $("#GSTR1Save").show();
            var url = '@Url.Action("Save", "GSTR1")';
            $("#divLoading").show();
            var frmdata = new FormData();
            frmdata.append("ddlRecordType", $("#ddlRecordType").val());
            frmdata.append("period", $("#period").val());
            frmdata.append("ddlGSTINNo", $("#ddlGSTINNo").val());
            frmdata.append("ddlGSTR", $("#ddlGSTR").val());
            frmdata.append("ddlActionType", $("#ddlActionType").val());
            frmdata.append("OTP", $("#OTP").val());
            frmdata.append("AUTH_GSTINNo", $("#AUTH_GSTINNo").val());
            frmdata.append("ViewSummary", $("#ViewSummary").val());
                $.ajax
                    ({
                        url: '/GSTR1/Save',
                        type: "POST",
                        contentType: false,
                        data: frmdata,
                        //async: true,
                        processData: false,
                        success: function (resp) {
                            $("#divLoading").hide();
                            if (resp.success) {
                                $('#TBL_GSTR1SAVE_SUMMARY').DataTable({
                                    destroy: true,
                                    "aaData": resp.data.GSTR1Summary,
                                    "aoColumns": [
                                        { "mData": "ActionType" },
                                        { "mData": "RecordCount" },
                                        { "mData": "NoOfInvoices" },
                                        { "mData": "txval" },
                                        { "mData": "iamt" },
                                        { "mData": "camt" },
                                        { "mData": "samt" },
                                        { "mData": "csamt" },
                                        {
                                            "mData": null,
                                            "bSortable": false,
                                            "mRender": function (data, type, full) {
                                                return '<button type="submit" name="command" id="exportrawData" value="exportrawData" class="btn btn-primary btn-lg btnstyle" onclick="javascript:return ShowMessage(this); " style="font-weight:bold; Border-radius:5px; width:80px; margin-bottom:3px; padding:3px;">Export</button>';
                                            }
                                        }
                                    ]
                                });
                            }
                            else {
                                swal({
                                    title: "",
                                    text: "@TempData["ErrorMessage"]",
                                    type: "error",
                                    confirm: {
                                        text: "OK",
                                        value: true,
                                        visible: true,
                                        className: "",
                                        closeModal: true,
                                    },
                                    confirmButtonColor: "#DD6B55",
                                    confirmButtonText: "OK",
                                    closeOnConfirm: true,
                                });
                            }
                        },
                        error: function (xhr) {
                            $("#divLoading").hide();
                            alert('error');
                        }
                    })
            });

            $("#ddlGSTINNo").change(function () {
                var url = '@Url.Action("Save", "GSTR1")';
                $("#divLoading").show();
                var frmdata = new FormData();
                frmdata.append("ddlRecordType", $("#ddlRecordType").val());
                frmdata.append("period", $("#period").val());
                frmdata.append("ddlGSTINNo", $("#ddlGSTINNo").val());
                frmdata.append("ddlGSTR", $("#ddlGSTR").val());
                frmdata.append("ddlActionType", $("#ddlActionType").val());
                frmdata.append("OTP", $("#OTP").val());
                frmdata.append("AUTH_GSTINNo", $("#AUTH_GSTINNo").val());
                $.ajax
                    ({
                        url: '/GSTR1/Save',
                        type: "POST",
                        contentType: false,
                        data: frmdata,
                        //async: true,
                        processData: false,
                        // cache: false,
                        success: function (resp) {
                            $("#divLoading").hide();
                            if (resp.success) {
                                if (resp.OTPSession == "OPEN_POPUP") {
                                    $("#innerHTML_AUTH_Response").html(resp.AUTH_Response);
                                    $("#AUTH_GSTINNo").val(resp.AUTH_GSTINNo);
                                    $("#innerHTML_AUTH_GSTINNo").html(resp.AUTH_GSTINNo);
                                    $("#innerHTML_AUTH_GSTINNo").html(resp.AUTH_GSTINNo);
                                    $(document).ready(function () {
                                        $('#myOTPModal').modal();
                                    });
                                }
                            }
                            else {

                            }
                        },
                        error: function (xhr) {
                            $("#divLoading").hide();
                            alert('error');
                        }
                    })
            });

            $("#ddlGSTR").change(function () {
                $("#DispActionType").show();
            });

        $("#ddlActionType").change(function () {
            var actiontype = $("#ddlActionType").val();
            if (actiontype == "HSN" || actiontype == "HSNSUM") {
                $("#btnHSNSummary").show();
            }
            else {
                $("#btnHSNSummary").hide();
            }
        });
    });

</script>

@section pagespecific{
    <script type="text/javascript">


        // DO NOT REMOVE : GLOBAL FUNCTIONS!

        $(document).ready(function () {

            var $checkoutForm = $('#GSTR1SaveForm').validate({
                // Rules for form validation
                rules: {
                    //ddlGSTINNo: {
                    //    required: true
                    //},
                    //ddlActionType: {
                    //    required: true
                    //},
                    period: {
                        required: true
                    },
                },

                // Messages for form validation
                messages: {
                    //ddlGSTINNo: {
                    //    required: 'Please select GSTIN No'
                    //},
                    //ddlActionType: {
                    //    required: 'Please select Action'
                    //},
                    period: {
                        required: 'Please Select Period'
                    }

                },

                // Do not change code below
                errorPlacement: function (error, element) {
                    error.insertAfter(element.parent());
                }
            });

        })

    </script>


}

