
<form name="ReconciliationSummary" id="ReconciliationSummary" method="post" autocomplete="off">
    <!-- MAIN CONTENT -->

    <div id="content">

        <!-- row -->
        <div class="row">

            <!-- col -->
            <div class="col-xs-12 col-sm-7 col-md-7 col-lg-6">
                <h1 class="page-title txt-color-blueDark">

                    <!-- PAGE HEADER -->
                    <i class="fa-fw fa fa-home"></i>
                    Reconciliation
                    <span>
                        >&nbsp;
                        Summary
                    </span>
                </h1>
            </div>
            <!-- end col -->
            <!-- right side of the page with the sparkline graphs -->
            <!-- col -->
            <!-- end col -->

        </div>

        <section id="widget-grid" class="">

            <!-- row -->
            <div class="row">

                <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                    <div class="jarviswidget jarviswidget-color-greenDark" id="wid-id-0" data-widget-editbutton="false" data-widget-custombutton="false" data-widget-deletebutton="false">

                        <header>
                            <span class="widget-icon"><i class="fa fa-edit"></i></span>
                            <h2 style="font-weight:bold;">Settings</h2>
                        </header>
                        <div>

                            <!-- widget edit box -->
                            <div class="jarviswidget-editbox">
                                <!-- This area used as dropdown edit box -->

                            </div>

                            <div class="widget-body no-padding">

                                <div id="comment-form" class="smart-form">
                                    <fieldset>
                                        <div class="col-sm-6 col-md-6 col-lg-6">
                                            <div id="accordion">
                                                <div>
                                                    <h4>Reconciliation Setting</h4>


                                                    <div class="form-group">

                                                        <div class="row">
                                                            @if (Session["f_year"] == "FinancialYear")
                                                            {

                                                                <label class="radio radio-inline">

                                                                    <input type="radio" class="radiobox" name="reconsetting" id="reconsetting" value="FinancialYear" checked>
                                                                    <span style="margin-left:0px">Invoice Date</span>

                                                                </label>
                                                                <label class="radio radio-inline" style="margin-left:auto">
                                                                    <input type="radio" class="radiobox" name="reconsetting" id="reconsetting" value="FinancialPeriod">
                                                                    <span style="margin-left:0px">Period</span>
                                                                </label>
                                                            }

                                                            else if (Session["f_year"] == "FinancialPeriod")
                                                            {
                                                                <label class="radio radio-inline">

                                                                    <input type="radio" class="radiobox" name="reconsetting" id="reconsetting" value="FinancialYear">
                                                                    <span style="margin-left:0px">Invoice Date</span>

                                                                </label>
                                                                <label class="radio radio-inline" style="margin-left:auto">
                                                                    <input type="radio" class="radiobox" name="reconsetting" id="reconsetting" value="FinancialPeriod" checked>
                                                                    <span style="margin-left:0px">Period</span>
                                                                </label>
                                                            }
                                                            else
                                                            {
                                                                <label class="radio radio-inline">

                                                                    <input type="radio" class="radiobox" name="reconsetting" id="reconsetting" value="FinancialYear" checked>
                                                                    <span style="margin-left:0px">Invoice Date</span>

                                                                </label>
                                                                <label class="radio radio-inline" style="margin-left:auto">
                                                                    <input type="radio" class="radiobox" name="reconsetting" id="reconsetting" value="FinancialPeriod">
                                                                    <span style="margin-left:0px">Period</span>
                                                                </label>
                                                            }
                                                        </div>
                                                    </div>


                                                </div>
                                            </div>
                                        </div>
                                    </fieldset>

                                </div>
                            </div>
                        </div>

                    </div>
                </article>

                <!-- NEW WIDGET START -->


                <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                    <!-- Widget ID (each widget will need unique ID)-->
                    <div class="jarviswidget jarviswidget-color-greenDark" id="wid-id-0" data-widget-editbutton="false" data-widget-custombutton="false" data-widget-deletebutton="false">

                        <header>
                            <span class="widget-icon"><i class="fa fa-edit"></i></span>
                            <h2 style="font-weight:bold;">Reconciliation Summary by Supplier</h2>
                        </header>

                        <!-- widget div-->
                        <div>

                            <!-- widget edit box -->
                            <div class="jarviswidget-editbox">
                                <!-- This area used as dropdown edit box -->

                            </div>
                            <!-- end widget edit box -->
                            <!-- widget content -->
                            <div class="widget-body no-padding">

                                <div id="comment-form" class="smart-form">

                                    <fieldset>

                                        @*@Html.AntiForgeryToken()*@
                                        <div class="row">
                                            <section class="col col-3">
                                                <label class="col-form-label">GSTIN</label>
                                                <label class="input">
                                                    @Html.DropDownList("ddlGSTINNo", ViewBag.GSTINNoList as SelectList, "ALL", new { @class = "form-control" })
                                                </label>
                                            </section>

                                            <section class="col col-3" id="frm">
                                                <label class="input">From</label>
                                                <label class="input">
                                                    <i class="icon-append fa fa-calendar"></i>
                                                    <input type="text" name="period" id="period" value="@ViewBag.Period" placeholder="From" class="datepicker" data-dateformat='mmyy'>
                                                </label>
                                            </section>

                                            <section class="col col-3" id="to">
                                                <label class="input">To</label>
                                                <label class="input">
                                                    <i class="icon-append fa fa-calendar"></i>
                                                    <input type="text" name="toperiod" id="toperiod" value="@ViewBag.ToPeriod" placeholder="To" class="datepicker" data-dateformat='mmyy'>
                                                </label>
                                            </section>
                                            <section class="col col-3" id="frmdt">
                                                <label class="input">From Invoice Date</label>
                                                <label class="input">
                                                    <i class="icon-append fa fa-calendar"></i>
                                                    <input type="text" name="fromdate" id="fromdate" value="@ViewBag.FromDate" placeholder="From Date" class="datepicker" data-dateformat='dd-mm-yy' readonly>
                                                </label>
                                            </section>

                                            <section class="col col-3" id="todt">
                                                <label class="input">To Invoice Date</label>
                                                <label class="input">
                                                    <i class="icon-append fa fa-calendar"></i>
                                                    <input type="text" name="todate" id="todate" value="@ViewBag.ToDate" placeholder="To Date" class="datepicker" data-dateformat='dd-mm-yy' readonly>
                                                </label>
                                            </section>

                                            @*<section class="col col-3" id="year">
                                                <label class="col-form-label">Financial Year</label>
                                                <label class="input">
                                                    @Html.DropDownList("years", ViewBag.yearlist as SelectList, "Select", new { @class = "form-control", id = "years" })
                                                </label>
                                            </section>*@
                                            <section class="col col-3">
                                                <label class="input"></label>
                                                <div class="form-group">
                                                    <input type="hidden" name="InvIds" id="InvIds" />
                                                    <input type="hidden" name="ctin" id="ctin" />
                                                    <input type="hidden" name="gstr2val" id="gstr2val" />
                                                    <input type="hidden" name="RefIds" id="RefIds" />
                                                    <input type="hidden" name="GSTIN" id="GSTIN" />
                                                </div>
                                            </section>
                                        </div>

                                    </fieldset>
                                    <footer>
                                        <button type="button" id="ViewDetails" name="ViewDetails" value="View Details" class="btn btn-primary pull-left" style="border-radius:13px; font-weight:600">
                                            View Details
                                        </button>
                                    </footer>
                                </div>

                            </div>
                            <!-- end widget content -->

                        </div>
                        <!-- end widget div -->

                    </div>


                    <div class="jarviswidget jarviswidget-color-blueLight" id="wid-id-1" data-widget-editbutton="false" data-widget-custombutton="false" data-widget-deletebutton="false">

                        <header>
                            <span class="widget-icon"> <i class="fa fa-edit"></i> </span>
                            <h2>Reconciliation Summary</h2>
                        </header>

                        <div class="table table-responsive">

                            <div class="container-fuild" style="background-color:white; overflow:scroll;">
                                <table id="TBL_ReconciliationSummary" class="table table-striped table-bordered dt-responsive nowrap" width="100%" cellspacing="0">
                                    <thead>
                                        <tr id="TD_Summary">
                                            <th>S.No</th>
                                            <th>GSTIN</th>
                                            <th>Supplier GSTIN</th>
                                            <th>Supplier Name</th>
                                            <th>GSTR2 Value</th>
                                            <th>GSTR2 Tax Amount</th>
                                            <th>GSTR2 Taxable Value</th>
                                            <th>GSTR2A Value</th>
                                            <th>GSTR2A Tax Amount</th>
                                            <th>GSTR2A Taxable Value</th>
                                            <th>Tax Difference</th>
                                            <th>Tax Difference Percentage</th>
                                            <th>View</th>
                                            <th hidden>supplierdet</th>
                                        </tr>
                                    </thead>
                                </table>

                            </div>

                        </div>


                        <div>

                            <!-- widget edit box -->
                            <div class="jarviswidget-editbox">
                                <!-- This area used as dropdown edit box -->

                            </div>
                            <!-- end widget edit box -->
                            <!-- widget content -->
                            <div class="widget-body no-padding">

                                <div id="comment-form1" class="smart-form">

                                    <fieldset></fieldset>

                                    <footer>

                                        <button type="submit" id="Export" name="Export" value="Export" class="btn btn-primary pull-left" style="border-radius:13px;font-weight:600">
                                            Export
                                        </button>

                                        <button type="submit" id="Export_b2b" name="Export_b2b" value="Export_B2B" class="btn btn-primary pull-left" style="border-radius:13px;font-weight:600">
                                            Export B2B
                                        </button>

                                        <button type="submit" id="Export_cdn" name="Export_cdn" value="Export_CDNR" class="btn btn-primary pull-left" style="border-radius:13px;font-weight:600">
                                            Export CDNR
                                        </button>
                                    </footer>

                                    <div class="message">
                                        <i class="fa fa-check fa-lg"></i>
                                        <p>
                                            Your comment was successfully added!
                                        </p>
                                    </div>

                                </div>
                            </div>
                            <!-- end widget content -->

                        </div>

                    </div>

                </article>
                <!-- end widget -->

                <div class="modal fade text-center" style="border-radius:3px;" id="summaryModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header" style="background:#568a89;color:#fff;border-color:#508180!important">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                    &times;
                                </button>
                                <h4 class="modal-title" id="myModalLabel"><b>Update Supplier GSTIN</b></h4>
                            </div>
                            <div class="modal-body terms-body">
                                <section class="col col-3">
                                    <label class="input">
                                        @*<h6 style="color:#71843f;font-weight:bold">Existing Supplier GSTIN</h6>

                                            <input type="text" name="ctin" placeholder="ctin" id="ctin" readonly class="form-control"
                                                   style="text-transform:uppercase; background-color:#e1e1e1;">

                                            <input type="hidden" name="ctin" id="ctin" value="@ViewBag.ctinValidation" />*@

                                        <label>Existing Supplier GSTIN</label> : <div id="innerctin" style="font-weight:bold;"></div>
                                        <input type="hidden" name="ctin" id="ctin" value="@ViewBag.ctinValidation" />

                                        <br /><br />
                                        <input type="text" id="newctin" name="newctin" class="form-group" placeholder="New Supplier GSTIN" onchange="ValidGSTINNo()" />
                                    </label>

                                </section>

                                @*<section class="col col-3">
                                        <label class="input">
                                            <h6 style="color:#71843f;font-weight:bold">New Supplier GSTIN</h6>
                                            <input type="text" name="newctin" placeholder="Supplier GSTIN" id="newctin"
                                                   style="text-transform:uppercase; background-color:#e1e1e1;" onchange="ValidGSTINNo()">
                                        </label>

                                    </section>*@
                            </div>

                            <div class="modal-footer">

                                <button type="button" class="btn btn-default" data-dismiss="modal">
                                    Cancel
                                </button>
                                <button type="button" id="Upload" name="Upload" value="Upload" class="btn btn-primary" style="border-radius:5px;font-weight:600">
                                    Update
                                </button>
                            </div>
                        </div>
                    </div>

                    }
                    <!-- end row -->
                    <!-- row -->

                    <div class="row">

                        <!-- a blank row to get started -->
                        <div class="col-sm-12">
                            <!-- your contents here -->
                        </div>

                    </div>

                    <!-- end row -->
                </div>

            </div>

        </section>
    </div>

</form>
<script type="text/javascript" language="javascript">

    $(document).ready(function () {
        $("#TBL_ReconciliationSummary").hide();
        $("#TD_Summary").hide();

        $.urlParam = function (name) {
            debugger;
            var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
            if (results == null) {
                return null;
            }
            else {
                return decodeURI(results[1]) || 0;
            }
        }
        var URLRedirectName = $.urlParam('Page');

        if (URLRedirectName == "ViewDetails") {

            $("#divLoading").show();
            ProcessingData();
        }

        $("#Upload").click(function () {
            debugger;

            var GST = document.getElementById("newctin").value;
            if (GST == null || GST == "")
            {
                swal({
                    title: "",
                    text: "Please enter Supplier GSTIN",
                    type: "error",
                    confirm: {
                        text: "OK",
                        value: true,
                        visible: true,
                        className: "",
                        closeModal: true,
                    },
                    confirmButtonColor: "#DD6B55",
                    confirmButtonText: "OK",
                    closeOnConfirm: true,
                });
            }

            else
            {
            var url = '@Url.Action("InvoiceCorrection", "InvoiceCorrection")';
            $("#divLoading").show();
            var frmdata = new FormData();

                var radio = $("input[type=radio][name='reconsetting']:checked").val();
               

            frmdata.append("ctin", $("#ctin").val());
            frmdata.append("ddlGSTINNoUpdate", $("#GSTIN").val());
            frmdata.append("ddlGSTINNo", $("#ddlGSTINNo").val());
            frmdata.append("period", $("#period").val());
            frmdata.append("toperiod", $("#toperiod").val());
            frmdata.append("fromdate", $("#fromdate").val());
            frmdata.append("todate", $("#todate").val());
           // frmdata.append("years", $("#years").val());
            frmdata.append("reconsetting", radio);
            frmdata.append("newctin", $("#newctin").val());
            frmdata.append("Upload", $("#Upload").val());
            $.ajax
                ({
                    url: '/InvoiceCorrection/InvoiceCorrection',
                    type: "POST",
                    contentType: false,
                    data: frmdata,
                    //async: true,
                    processData: false,
                    // cache: false,
                    success: function (resp) {
                        $("#divLoading").hide();
                        if (resp.success) {
                            //debugger;
                            //alert(resp.data);
                            if (resp.SuccessMessage != null) {
                                $('#summaryModal').modal('toggle');
                                swal({
                                    title: "",
                                    text: resp.SuccessMessage,
                                    type: "success",
                                    confirm: {
                                        text: "OK",
                                        value: true,
                                        visible: true,
                                        className: "",
                                        closeModal: true,
                                    },
                                    confirmButtonColor: "#DD6B55",
                                    confirmButtonText: "OK",
                                    closeOnConfirm: true,
                                });
                                LoadGrid(resp.data.ReconciliationSummary);
                            }
                            else {
                                //alert(summaryModal.ErrorMessage);
                                $('#summaryModal').modal('toggle');
                                swal({
                                    title: "",
                                    text: resp.ErrorMessage,
                                    type: "error",
                                    confirm: {
                                        text: "OK",
                                        value: true,
                                        visible: true,
                                        className: "",
                                        closeModal: true,
                                    },
                                    confirmButtonColor: "#DD6B55",
                                    confirmButtonText: "OK",
                                    closeOnConfirm: true,
                                });
                                // LoadGrid(resp.data.ReconciliationSummary);
                            }
                        }
                        else {
                            //alert(resp.ErrorMessage);
                            $('#summaryModal').modal('toggle');
                            swal({
                                title: "",
                                text: resp.ErrorMessage,
                                type: "error",
                                confirm: {
                                    text: "OK",
                                    value: true,
                                    visible: true,
                                    className: "",
                                    closeModal: true,
                                },
                                confirmButtonColor: "#DD6B55",
                                confirmButtonText: "OK",
                                closeOnConfirm: true,
                            });
                        }
                    },
                    error: function (xhr) {
                        $("#divLoading").hide();
                        alert('error');
                    }
                })
        }
        });

        $("#chkSelectAll").click(function () {
            var table = $("#TBL_ReconciliationSummary").DataTable();
            var filtervalue = table.search();

            if (filtervalue != "") {
                var cols = $("#TBL_ReconciliationSummary").DataTable().rows({ search: 'applied' }).nodes();
                for (var i = 0; i < cols.length; i += 1) {
                    cols[i].querySelector("input[type='checkbox']").checked = this.checked;
                }
            }
            else {
                var cols = $("#TBL_ReconciliationSummary").DataTable().column(0).nodes(),
                    state = this.checked;
                for (var i = 0; i < cols.length; i += 1) {
                    cols[i].querySelector("input[type='checkbox']").checked = state;
                }
            }
        });

        $('.chkSelectAll').click(function () {
            var status = this.checked;
            if (status == false) {
                $("#chkSelectAll").prop("checked", false);
            }
        });

        $("#TBL_ReconciliationSummary").on("click", ".chkSelectAll", function () {
            var status = this.checked;
            if (status == false) {
                $("#chkSelectAll").prop("checked", false);
            }
        });

        $("#ViewDetails").click(function () {
            $("#divLoading").show();
            ProcessingData();
            //var radio = $("input[type=radio][name='reconsetting']:checked").val();
            //if (radio == "FinancialYear") {
            //    var YEAR = jQuery("#years option:selected").text();
            //    if (YEAR == null || YEAR == "" || YEAR == "Select") {
            //        alert("Please Select Financial Year");
            //    }
            //    else {
            //        $("#divLoading").show();
            //        ProcessingData();
            //    }
            //}
            //else {
            //    $("#divLoading").show();
            //    ProcessingData();
            //}
        });

        $("#ddlSupplierName").change(function () {
            LoadingData();
            window.location.reload(true);
        });

    });


    function ProcessingData(ButtonType) {
        debugger;
        var frmdata = new FormData();
        var radio = $("input[type=radio][name='reconsetting']:checked").val();

        if (radio == "FinancialPeriod") {

            frmdata.append("ddlGSTINNo", $("#ddlGSTINNo").val());
            frmdata.append("period", $("#period").val());
            frmdata.append("toperiod", $("#toperiod").val());
            frmdata.append("reconsetting", radio);
            frmdata.append("fromdate", $("#fromdate").val());
            frmdata.append("todate", $("#todate").val());

        }
        else if (radio == "FinancialYear") {

            frmdata.append("ddlGSTINNo", $("#ddlGSTINNo").val());
            frmdata.append("fromdate", $("#fromdate").val());
            frmdata.append("todate", $("#todate").val());
            //frmdata.append("years", $("#years").val());
            frmdata.append("reconsetting", radio);
            frmdata.append("period", $("#period").val());
            frmdata.append("toperiod", $("#toperiod").val());
        }
        else {
            frmdata.append("ddlGSTINNo", $("#ddlGSTINNo").val());
            frmdata.append("fromdate", $("#fromdate").val());
            frmdata.append("todate", $("#todate").val());
           // frmdata.append("years", $("#years").val());
            frmdata.append("reconsetting", $("#reconsetting").val());
            frmdata.append("period", $("#period").val());
            frmdata.append("toperiod", $("#toperiod").val());
        }
        if (ButtonType != null) {
            frmdata.append("InvIds", $("#InvIds").val());
            frmdata.append("RefIds", $("#RefIds").val());
        }

        $.ajax
            ({
                url: '/InvoiceCorrection/InvoiceCorrection',
                type: "POST",
                contentType: false,
                data: frmdata,
                //async: true,
                processData: false,
                // cache: false,
                success: function (resp) {
                    $("#divLoading").hide();
                    debugger;
                    if (resp.success) {
                        if (ButtonType != null) {
                            swal({
                                title: "",
                                text: resp.SuccessMessage,
                                type: "success",
                                confirm: {
                                    text: "OK",
                                    value: true,
                                    visible: true,
                                    className: "",
                                    closeModal: true,
                                },
                                confirmButtonColor: "#DD6B55",
                                confirmButtonText: "OK",
                                closeOnConfirm: true,
                            });
                        }
                        $("#TBL_ReconciliationSummary").show();
                        $("#TD_Summary").show();
                        LoadGrid(resp.data.ReconciliationSummary);
                    }
                    else {
                        swal({
                            title: "",
                            text: resp.ErrorMessage,
                            type: "error",
                            confirm: {
                                text: "OK",
                                value: true,
                                visible: true,
                                className: "",
                                closeModal: true,
                            },
                            confirmButtonColor: "#DD6B55",
                            confirmButtonText: "OK",
                            closeOnConfirm: true,
                        });
                    }
                    //alert(data);
                },
                error: function (xhr) {
                    $("#divLoading").hide();
                    alert(xhr.statusText);
                }
            })
    }

    function LoadGrid(ResData) {
        console.log(ResData);

        $('#TBL_ReconciliationSummary').DataTable({
            destroy: true,
            "aaData": ResData,
            "aoColumns": [
                {
                    "targets": 0,
                    "searchable": false,
                    "orderable": false,
                    "width": '2%',
                    "className": 'chkSelectAll',
                    "data": 'id',
                    "render": function (data, type, full, meta) {

                        return meta.row + meta.settings._iDisplayStart + 1;
                    }
                },
                { "mData": "gstin" },
                { "mData": "SupplierGstin" },
               // { "mData": "SupplierName" },
                {
                    "targets": 10,
                    "searchable": false,
                    "orderable": false,
                    "data": 'supplierdetails',
                    "render": function (data, type, full, meta) {
                        var details = data.split("--");
                        var c_name = details[3];
                        if (c_name != "") {
                            return '<button type="button" id="EditItems" value="' + data + '" onclick="CTINUpdate(this.value) " class="btn btn-link" style="text-decoration:underline;">' + c_name + '</button>';

                        }
                        else {
                            return '<button type="button" id="EditItems" value="' + data + '" onclick="CTINUpdate(this.value) " class="btn btn-link" style="text-decoration:underline;">Update Supplier Details</button>';

                        }
                    }
                },
                { "mData": "GSTR2Val" },
                { "mData": "GSTR2Taxamount" },
                { "mData": "GSTR2taxVal" },
                { "mData": "GSTR2AVal" },
                { "mData": "GSTR2ATaxamount" },
                { "mData": "GSTR2AtaxVal" },
                { "mData": "TaxDiff" },
                { "mData": "TaxDiffPercent" },
                {
                    "targets": 10,
                    "searchable": false,
                    "orderable": false,
                    "data": 'supplierdetails',
                    "render": function (data, type, full, meta) {
                        var details = data.split("--");
                        var c_name = details[3];
                        if (c_name != "") {
                            return '<button type="button" class="btn btn-md glyphicon glyphicon-chevron-right" id ="btnTo" value="' + data + '" onclick="GoTo(this.value)" style="width:2px;color:darkgreen;margin-right:10px;"></button>';
                        }
                        else
                        {
                            return '';

                        }
                        }
                },
                {
                    "targets": 1,
                    "visible": false,
                    "searchable": false,
                    "data": 'supplierdetails',
                    "render": function (data, type, full, meta) {
                        return '<input type="hidden" name="RefIds" id="RefIds" value="' + data + '" />';
                    },
                },
            ]
        });

    }


    function GoTo(value) {
        debugger;

        var data = value;
        var array = value.split("--");
        var gstin = array[0];
        var ctin = array[1];
        var val2a = array[2];
        var c_name = array[3];

       

        $("#divLoading").show();

       window.location.href = '@Url.Action("ctinWise", "InvoiceCorrection")' + '?ctin=' + ctin + '&supp_name=' + c_name + '&gstin=' + gstin;


      //  document.location.href = '/GSTR2/Reconcilation?Page=ViewDetails';
    }

        function CTINUpdate(value) {
        debugger;

        var data = value;
        var array = value.split("--");
        var gstin = array[0];
        var ctin = array[1];
        var val2 = array[2];
        var c_name = array[3];

            $("#GSTIN").val(gstin);
            //'<%Session["gstinno"] = "' + gstin + '"; %>';
            var radio = $("input[type=radio][name='reconsetting']:checked").val();

                $("#divLoading").show();
                var frmdata = new FormData();
                frmdata.append("ctin", ctin);
                frmdata.append("gstr2val", val2);
                frmdata.append("ddlGSTINNo", gstin);
                frmdata.append("period", $("#period").val());
                frmdata.append("toperiod", $("#toperiod").val());
                frmdata.append("fromdate", $("#fromdate").val());
            frmdata.append("todate", $("#todate").val());
            //frmdata.append("years", $("#years").val());
            frmdata.append("reconsetting", radio);
                $.ajax
                    ({
                        url: '/InvoiceCorrection/InvoiceCorrection',
                        type: "POST",
                        contentType: false,
                        data: frmdata,
                        //async: true,
                        processData: false,
                        // cache: false,
                        success: function (resp) {
                            $("#divLoading").hide();
                            if (resp.success) {
                                if (resp.ctin != null && resp.ErrorMessage == null) {
                                    $("#ctin").val(resp.ctin);
                                    $("#innerctin").html(resp.ctin);
                                    $("#innerctin").html(resp.ctin);
                                    $(document).ready(function () {
                                        $('#summaryModal').modal();
                                    });
                                }

                                else if (resp.ErrorMessage != null) {
                                    //alert(summaryModal.ErrorMessage);
                                   // $('#summaryModal').modal('toggle');
                                    swal({
                                        title: "",
                                        text: resp.ErrorMessage,
                                        type: "error",
                                        confirm: {
                                            text: "OK",
                                            value: true,
                                            visible: true,
                                            className: "",
                                            closeModal: true,
                                        },
                                        confirmButtonColor: "#DD6B55",
                                        confirmButtonText: "OK",
                                        closeOnConfirm: true,
                                    });
                                   // LoadGrid(resp.data.ReconciliationSummary);
                                }
                                else {
                                    //alert(resp.ErrorMessage);
                                   // $('#summaryModal').modal('toggle');
                                    swal({
                                        title: "",
                                        text: resp.ErrorMessage,
                                        type: "error",
                                        confirm: {
                                            text: "OK",
                                            value: true,
                                            visible: true,
                                            className: "",
                                            closeModal: true,
                                        },
                                        confirmButtonColor: "#DD6B55",
                                        confirmButtonText: "OK",
                                        closeOnConfirm: true,
                                    });
                                }
                            }
                            else {

                            }
                        },
                        error: function (xhr) {
                            $("#divLoading").hide();
                            alert('error');
                        }
                })
    }


        function ShowMessage(param) {
        var data = param.value;
        var ph = $("#DivToAppendPartialVoew");
            ph.load("Index?SupplierGstin=" + data, function () {
            ph.dialog({
                modal: true,
                width: 1000,
                height: 400,
                title: "UPDATE Supplier GSTIN",
                resizable: true
            });
        });
    }

</script>


@section pagespecific{


    <script>
        $('input:radio').change(function (e) {

            var radio = $("input[type=radio][name='reconsetting']:checked").val();

            if (radio == "FinancialYear") {
                $("#frm").hide();
                $("#to").hide();
                $("#frmdt").show();
                $("#todt").show();
              //  $("#year").show();
            }
            else if (radio == "FinancialPeriod") {
                $("#frmdt").hide();
                $("#todt").hide();
               // $("#year").hide();
                $("#frm").show();
                $("#to").show();
            }
            else {
                $("#frm").hide();
                $("#to").hide();
                $("#frmdt").show();
                $("#todt").show();
               // $("#year").show();
            }
        })
    </script>

    <script>
    $(document).ready(function ()  {

        var radio = '@Session["f_year"]';

        if (radio == "FinancialYear") {
            $("#frm").hide();
            $("#to").hide();
            $("#frmdt").show();
            $("#todt").show();
           // $("#year").show();
        }
        else if (radio == "FinancialPeriod") {
            $("#frmdt").hide();
            $("#todt").hide();
          //  $("#year").hide();
            $("#frm").show();
            $("#to").show();
        }
        else {
            $("#frm").hide();
            $("#to").hide();
            $("#frmdt").show();
            $("#todt").show();
          //  $("#year").show();
        }
    })
    </script>
}

<script>

        function ValidGSTINNo() {
            GST = document.getElementById("newctin").value;
            if (GST != "") {
                var pat = /^[0-9]{2}[a-zA-Z]{5}[0-9]{4}[a-zA-Z]{1}[1-9a-zA-Z]{1}[zZ][0-9a-zA-Z]{1}$/;
                var res = pat.test(GST);
                if (res) {
                    var statecode = GST.substr(0, 2);
                    if (statecode == 00 || (statecode > 37 && statecode != 98)) {
                        alert("State code should be within the range of 01 to 37");
                    }
                    else {

                    }
                }
                else {
                    alert("CTIN is not in correct format.");
                }
            }
        }

        function ctinWise(ctin, c_name, gstin, fromPeriod, toPeriod) {
            debugger;
            window.location.href = '@Url.Action("ctinWise", "InvoiceCorrection")' + '?ctin=' + ctin + '&supp_name=' + c_name + '&gstin=' + gstin + '&fromPeriod=' + fromPeriod + '&toPeriod=' + toPeriod;
        }

</script>



